# ğŸªµ lamdaè¡¨è¾¾å¼|C++11

### åŒ¿åå‡½æ•°çš„åŸºæœ¬è¯­æ³•

```c
//åŒ¿åå‡½æ•°çš„åŸºæœ¬è¯­æ³•ä¸º
//[æ•è·åˆ—è¡¨](å‚æ•°åˆ—è¡¨)->è¿”å›ç±»å‹{å‡½æ•°ä½“}
void test1()
{
    auto Add = [](int a, int b) -> int {
        return a + b;
    };
    std::cout << Add(1, 2) << std::endl;        //è¾“å‡º3
}
```

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨æ¨æ–­å‡ºlambdaè¡¨è¾¾å¼çš„è¿”å›ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸æŒ‡å®šè¿”å›ç±»å‹ï¼Œå³ï¼š

```c
//ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨æ¨æ–­å‡ºlambdaè¡¨è¾¾å¼çš„è¿”å›ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸æŒ‡å®šè¿”å›ç±»å‹
//[æ•è·åˆ—è¡¨](å‚æ•°åˆ—è¡¨){å‡½æ•°ä½“}
void test2()
{
    auto Add = [](int a, int b) {
        return a + b;
    };
    std::cout << Add(1, 2) << std::endl;        //è¾“å‡º3
}
```

<mark style="color:red;">åœ¨ C++11 åŠå…¶ä¹‹åçš„æ ‡å‡†ä¸­ï¼Œå¦‚æœ Lambda è¡¨è¾¾å¼å‡½æ•°ä½“å†…æœ‰å¤šä¸ª</mark> <mark style="color:red;"></mark><mark style="color:red;">`return`</mark> <mark style="color:red;"></mark><mark style="color:red;">è¯­å¥ä¸”è¿”å›ç±»å‹ä¸ä¸€è‡´ï¼Œç¼–è¯‘å™¨æ— æ³•è‡ªåŠ¨æ¨æ–­å‡ºè¿”å›ç±»å‹ï¼Œæ­¤æ—¶å¿…é¡»æ˜¾å¼æŒ‡å®šè¿”å›ç±»å‹ã€‚</mark>

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```cpp
#include <iostream>
#include <string>

int main() {
    auto example = [](int x) -> std::string {
        if (x > 0) {
            return "Positive";
        } else if (x < 0) {
            return "Negative";
        } else {
            return "Zero";
        }
    };

    std::cout << example(10) << std::endl;   // è¾“å‡º "Positive"
    std::cout << example(-5) << std::endl;   // è¾“å‡º "Negative"
    std::cout << example(0) << std::endl;    // è¾“å‡º "Zero"

    return 0;
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒLambda è¡¨è¾¾å¼çš„è¿”å›ç±»å‹æ˜¯ `std::string`ã€‚ç”±äºå‡½æ•°ä½“å†…æœ‰å¤šä¸ª `return` è¯­å¥ï¼Œç¼–è¯‘å™¨æ— æ³•è‡ªåŠ¨æ¨æ–­å‡ºè¿”å›ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨ `-> std::string` æ˜ç¡®æŒ‡å®šäº†è¿”å›ç±»å‹ã€‚

<mark style="color:red;">**å¦ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºè¿”å›ä¸åŒç±»å‹çš„æƒ…å†µï¼š**</mark>

```cpp
#include <iostream>
#include <variant>

int main() {
    auto example = [](int x) -> std::variant<int, std::string> {
        if (x > 0) {
            return x;
        } else {
            return "Negative or Zero";
        }
    };

    auto result1 = example(10);
    auto result2 = example(-5);

    if (std::holds_alternative<int>(result1)) {
        std::cout << "Result1: " << std::get<int>(result1) << std::endl;
    } else {
        std::cout << "Result1: " << std::get<std::string>(result1) << std::endl;
    }

    if (std::holds_alternative<int>(result2)) {
        std::cout << "Result2: " << std::get<int>(result2) << std::endl;
    } else {
        std::cout << "Result2: " << std::get<std::string>(result2) << std::endl;
    }

    return 0;
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒLambda è¡¨è¾¾å¼çš„è¿”å›ç±»å‹æ˜¯ `std::variant<int, std::string>`ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥åœ¨ä¸åŒæƒ…å†µä¸‹è¿”å›ä¸åŒç±»å‹çš„å€¼ã€‚ç”±äº Lambda è¡¨è¾¾å¼æœ‰å¤šä¸ª `return` è¯­å¥ä¸”è¿”å›ç±»å‹ä¸åŒï¼Œæˆ‘ä»¬å¿…é¡»æ˜¾å¼æŒ‡å®šè¿”å›ç±»å‹ä¸º `std::variant<int, std::string>`ã€‚

### æ•è·åˆ—è¡¨

æœ‰æ—¶å€™ï¼Œéœ€è¦åœ¨åŒ¿åå‡½æ•°å†…ä½¿ç”¨å¤–éƒ¨å˜é‡ï¼Œæ‰€ä»¥ç”¨æ•è·åˆ—è¡¨æ¥ä¼ å‚ï¼Œå¦‚

```cpp
void test3()
{
    int c = 12;
    int d = 30;
    auto Add = [c, d](int a, int b)->int { //æ•è·åˆ—è¡¨åŠ å…¥ä½¿ç”¨çš„å¤–éƒ¨å˜é‡cï¼Œå¦åˆ™æ— æ³•é€šè¿‡ç¼–è¯‘
        cout << "d = " << d  << endl;
        return c;
    };
    d = 20;
    std::cout << Add(1, 2) << std::endl;
}
```

ä½†æ˜¯ï¼Œå¦‚æœAddä¸­åŠ å…¥ä¸€å¥ï¼šc = a;

```cpp
void test4()
{
    int c = 12;
    auto Add = [c](int a, int b)->int { //æ•è·åˆ—è¡¨åŠ å…¥ä½¿ç”¨çš„å¤–éƒ¨å˜é‡cï¼Œå¦åˆ™æ— æ³•é€šè¿‡ç¼–è¯‘
//        c = a; // ç¼–è¯‘æŠ¥é”™
        return c;
    };
    std::cout << Add(1, 2) << std::endl;
}
```

1. å¦‚æœæ•è·åˆ—è¡¨ä¸º`[&]`ï¼Œåˆ™è¡¨ç¤ºæ‰€æœ‰çš„å¤–éƒ¨å˜é‡éƒ½æŒ‰å¼•ç”¨ä¼ é€’ç»™lambdaä½¿ç”¨ï¼›
2. å¦‚æœæ•è·åˆ—è¡¨ä¸º`[=]`ï¼Œåˆ™è¡¨ç¤ºæ‰€æœ‰çš„å¤–éƒ¨å˜é‡éƒ½æŒ‰å€¼ä¼ é€’ç»™lambdaä½¿ç”¨ï¼›
3. `[this]` ï¼Œæ•è·å½“å‰ç±»ä¸­çš„thisæŒ‡é’ˆï¼Œè®©lambdaè¡¨è¾¾å¼æ‹¥æœ‰å’Œå½“å‰ç±»æˆå‘˜å‡½æ•°åŒæ ·çš„è®¿é—®æƒé™ï¼Œå¦‚æœå·²ç»ä½¿ç”¨äº† & æˆ–è€… =, é»˜è®¤æ·»åŠ æ­¤é€‰é¡¹
4. åŒ¿åå‡½æ•°æ„å»ºçš„æ—¶å€™å¯¹äºæŒ‰å€¼ä¼ é€’çš„æ•è·åˆ—è¡¨ï¼Œä¼šç«‹å³å°†å½“å‰å¯ä»¥å–åˆ°çš„å€¼æ‹·è´ä¸€ä»½ä½œä¸ºå¸¸æ•°ï¼Œç„¶ åå°†è¯¥å¸¸æ•°ä½œä¸ºå‚æ•°ä¼ é€’ã€‚

```cpp
void test5()
{
    int c = 12;
    int d = 30;
    auto Add = [&c, &d](int a, int b)->int { //æ•è·åˆ—è¡¨åŠ å…¥ä½¿ç”¨çš„å¤–éƒ¨å˜é‡cï¼Œå¦åˆ™æ— æ³•é€šè¿‡ç¼–è¯‘
        c = a; // ç¼–è¯‘å¯¹çš„
        cout << "d = " << d  << endl;
        return c;
    };
    d = 20;
    std::cout << Add(1, 2) << std::endl;
}
```

```c
void test6() {
    int c = 12;
    int d = 30;
    auto Add = [&c, &d](int& a, int& b) -> int {  // æ•è·åˆ—è¡¨åŠ å…¥ä½¿ç”¨çš„å¤–éƒ¨å˜é‡cï¼Œå¦åˆ™æ— æ³•é€šè¿‡ç¼–è¯‘
        a = 11;
        b = 12;
        cout << "d = " << d << endl;  // d = 12
        return a + b; // 23
    };
    d = 20;
    std::cout << Add(c, d) << std::endl;
    cout << "c = " << c << endl;  // c = 11
    cout << "d = " << d << endl;  // d = 12
}
```

### åŒ¿åå‡½æ•°çš„ç®€å†™

åŒ¿åå‡½æ•°ç”±æ•è·åˆ—è¡¨ã€å‚æ•°åˆ—è¡¨ã€è¿”å›ç±»å‹å’Œå‡½æ•°ä½“ç»„æˆï¼›å¯ä»¥å¿½ç•¥å‚æ•°åˆ—è¡¨å’Œè¿”å›ç±»å‹ï¼Œä½†ä¸å¯ä»¥å¿½ ç•¥æ•è·åˆ—è¡¨å’Œå‡½æ•°ä½“ï¼Œå¦‚ï¼š

> auto f = \[]{ return 1 + 2; };

### Lambdaæ•è·åˆ—è¡¨

<table><thead><tr><th width="171">[]</th><th>ç©ºæ•è·åˆ—è¡¨ï¼ŒLambdaä¸èƒ½ä½¿ç”¨æ‰€åœ¨å‡½æ•°ä¸­çš„å˜é‡ã€‚</th></tr></thead><tbody><tr><td>[names]</td><td>namesæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„åå­—åˆ—è¡¨ï¼Œè¿™äº›åå­—éƒ½æ˜¯Lambdaæ‰€åœ¨å‡½æ•°çš„å±€éƒ¨ å˜é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›å˜é‡ä¼šè¢«æ‹·è´ï¼Œç„¶åæŒ‰å€¼ä¼ é€’ï¼Œåå­—å‰é¢å¦‚æœä½¿ç”¨ äº†&#x26;ï¼Œåˆ™æŒ‰å¼•ç”¨ä¼ é€’</td></tr><tr><td>[&#x26;]</td><td>éšå¼æ•è·åˆ—è¡¨ï¼ŒLambdaä½“å†…ä½¿ç”¨çš„å±€éƒ¨å˜é‡éƒ½æŒ‰å¼•ç”¨æ–¹å¼ä¼ é€’</td></tr><tr><td>[=]</td><td>éšå¼æ•è·åˆ—è¡¨ï¼ŒLanbdaä½“å†…ä½¿ç”¨çš„å±€éƒ¨å˜é‡éƒ½æŒ‰å€¼ä¼ é€’</td></tr><tr><td>[&#x26;,identifier_list]</td><td>identifier_listæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„åˆ—è¡¨ï¼ŒåŒ…å«0ä¸ªæˆ–å¤šä¸ªæ¥è‡ªæ‰€åœ¨å‡½æ•°çš„å˜é‡ï¼Œ è¿™äº›å˜é‡é‡‡ç”¨å€¼æ•è·çš„æ–¹å¼ï¼Œå…¶ä»–å˜é‡åˆ™è¢«éšå¼æ•è·ï¼Œé‡‡ç”¨å¼•ç”¨æ–¹å¼ä¼ é€’ï¼Œ identifier_listä¸­çš„åå­—å‰é¢ä¸èƒ½ä½¿ç”¨&#x26;ã€‚</td></tr><tr><td>[=,identifier_list]</td><td>identifier_listä¸­çš„å˜é‡é‡‡ç”¨å¼•ç”¨æ–¹å¼æ•è·ï¼Œè€Œè¢«éšå¼æ•è·çš„å˜é‡éƒ½é‡‡ç”¨æŒ‰å€¼ ä¼ é€’çš„æ–¹å¼æ•è·ã€‚identifier_listä¸­çš„åå­—ä¸èƒ½åŒ…å«thisï¼Œä¸”è¿™äº›åå­—é¢å‰å¿…é¡» ä½¿ç”¨&#x26;ã€‚</td></tr></tbody></table>

### lamdaè¡¨è¾¾å¼çš„æœ¬è´¨

ä½¿ç”¨lambdaè¡¨è¾¾å¼æ•è·åˆ—è¡¨æ•è·å¤–éƒ¨å˜é‡ï¼Œå¦‚æœå¸Œæœ›å»ä¿®æ”¹æŒ‰å€¼æ•è·çš„å¤–éƒ¨å˜é‡ï¼Œé‚£ä¹ˆåº”è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿè¿™å°±éœ€è¦ä½¿ç”¨mutableé€‰é¡¹ï¼Œ**è¢«mutableä¿®æ”¹æ˜¯lambdaè¡¨è¾¾å¼å°±ç®—æ²¡æœ‰å‚æ•°ä¹Ÿè¦å†™æ˜å‚æ•°åˆ—è¡¨ï¼Œå¹¶ä¸”å¯ä»¥å»æ‰æŒ‰å€¼æ•è·çš„å¤–éƒ¨å˜é‡çš„åªè¯»ï¼ˆconstï¼‰å±æ€§ã€‚**

```cpp
int a = 0;
auto f1 = [=] {return a++; };              // error, æŒ‰å€¼æ•è·å¤–éƒ¨å˜é‡, aæ˜¯åªè¯»çš„
auto f2 = [=]()mutable {return a++; };     // ok åœ¨å¤–éƒ¨açš„å€¼ä»ç„¶æ˜¯0
```

mutableé€‰é¡¹çš„ä½œç”¨å°±åœ¨äºå–æ¶ˆoperator()çš„constå±æ€§ã€‚

### reference

* [https://subingwen.cn/cpp/lambda/](https://subingwen.cn/cpp/lambda/)
